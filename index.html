
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>English coach</title>
    <style>
        ul {
            list-style-type: none;
        }
    </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
  <!-- Import the React, React-Dom and Babel libraries from unpkg -->
    <script type="application/javascript" src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script type="application/javascript" src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
    <script type="application/javascript" src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
  </head>

  <body>
    <div id="root"></div>
  
    <script type="text/babel">
        const rootElement = document.getElementById('root')

        class FactRow {
            constructor(required, options, ending) {
                this.required = required
                this.options = options
                this.ending = ending
            }
        }

        class Topic {
            constructor(name, facts) {
            this.name = name
            this.facts = facts
            }
        }

        const data = [
            new Topic("Test topic 1", [
                new FactRow(["req11"], ["opt11", "opt21", "opt31"], "end 1"),
            ]),
            new Topic("Test topic 2", [
                new FactRow(["req12"], ["opt12", "opt22", "opt32"], "end 2"),
            ]),
        ];

        var activeTopics = new Set(data)

        

        // var currentTopic = Math.floor(Math.random() * activeTopics.size);

        class TopicComponent extends React.Component {
            constructor(props) {
                super(props)

                this.state = {
                    currentTopic: Math.floor(Math.random() * activeTopics.size),
                    allTopics: props.topics,
                    activeTopics: new Set(props.topics),
                    countTrue: 0,
                    countFalse: 0,
                    previous: "",
                }

                this.onNextClick = this.onNextClick.bind(this);
                this.onInputChange = this.onInputChange.bind(this);
                this.onTopicSelected = this.onTopicSelected.bind(this);
            }

            onInputChange(desired) {
                var self = this
                return function(e){
                    if (desired == e.target.value) {
                        self.goNext(true)
                    }
                }
            }

            onTopicSelected(topic) {
                var self = this
                return function(e) {

                    if (self.state.activeTopics.has(topic)) {
                        if (self.state.activeTopics.size == 1) return
                        self.state.activeTopics.delete(topic)
                    } else {
                        self.state.activeTopics.add(topic)
                    }

                    self.state.currentTopic = Math.floor(Math.random() * self.state.activeTopics.size)

                    self.setState(self.state)
                }
            }

            onNextClick() {
                this.goNext(false)
            }

            render() {
                const active = this.state.activeTopics
                const list = [...active]

                const topic = list[this.state.currentTopic]
                const fact = topic.facts[Math.floor(Math.random() * topic.facts.length)]

                const question = Math.floor(Math.random() * fact.options.length)

                const optionsDisplay = fact.options.map((x, i) => <i> { question != i ? x : <input name="answer" onChange={this.onInputChange(x)} autoFocus defaultValue=""/>} </i>)

                this.currentLine = `[${topic.name}] ${"".concat(...fact.required.map(x => " " + x))} ${"".concat(...fact.options.map(x => " " + x))} ${fact.ending}`

                return <div class="topic-component container">
                    <div  class="mb-3">
                        <h1>{topic.name}</h1>

                        {fact.required.map(x => <b> {x} </b>)}

                        {optionsDisplay}

                        <b> {fact.ending} </b>
                    </div>

                    <div class="card text-bg-light mb-3">
                        <div class="card-header">Previous</div>
                        <div class="card-body">
                            <p class="card-text">{this.state.previous}</p>
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary" onClick={this.onNextClick}>
                        Next
                    </button>

                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                        </svg>:{this.state.countTrue}
                        <i> </i>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-slash-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                            <path d="M11.354 4.646a.5.5 0 0 0-.708 0l-6 6a.5.5 0 0 0 .708.708l6-6a.5.5 0 0 0 0-.708"/>
                        </svg>:{this.state.countFalse}
                    </div>
                
                    <ul class="list-group">
                        {data.map(t => <li class="list-group-item"><input class="form-check-input" type="checkbox" id={t.name} onChange={this.onTopicSelected(t)} defaultChecked={this.state.activeTopics.has(t)}/><label class="form-check-label" for={t.name}>{t.name}</label></li>)}
                    </ul>
                </div>
            }

            goNext(isCorrect) {
                this.state.currentTopic = Math.floor(Math.random() * this.state.activeTopics.size)
                this.state.previous = this.currentLine
                if (isCorrect) {
                    this.state.countTrue ++
                } else {
                    this.state.countFalse ++
                }
                this.setState(this.state)
            }
        }
      
        function App(){
            return(
            <div>
                <TopicComponent topics={data} />
            </div>
            )
        }

        ReactDOM.render(
            <App />,
            rootElement
        )
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  </body>

</html>
